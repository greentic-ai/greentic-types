# PR-01.md (greentic-types)
# Title: PackManifest extensions (core-only, stable)

## Goal
Add a forward-compatible **extensions** mechanism to `PackManifest` so provider-specific metadata (messaging/secrets/events/â€¦) lives outside core types.

## Non-goals
- Do **not** add any domain/provider-specific fields to `PackManifest` beyond the generic `extensions` mechanism.
- Do **not** introduce new heavy dependencies.

## Design
Add:
- `PackManifest.extensions: Option<BTreeMap<String, ExtensionRef>>`

Where:
- `ExtensionRef.kind`: extension kind identifier (e.g. `"greentic.ext.provider"`)
- `ExtensionRef.version`: string `"1.0.0"` (no semver crate requirement)
- `ExtensionRef.digest`: optional content digest (e.g., `sha256:...`)
- `ExtensionRef.location`: optional URI where extension payload can be fetched (ideally pinned by `digest`)
- `ExtensionRef.inline`: optional JSON value for small embedded extension payloads

### Serialization rules
- `extensions` omitted when `None` / empty
- Unknown extensions MUST parse without error and be preserved on re-serialize

## Tasks
1. **Types**
   - Update `src/pack_manifest.rs` (or wherever `PackManifest` lives):
     - Add `extensions` field (optional)
   - Add new struct:
     - `ExtensionRef` in a suitable module (same file or `src/extensions.rs`)
2. **Serde**
   - Ensure `#[serde(skip_serializing_if = "Option::is_none")]`
   - Ensure map ordering stable (`BTreeMap`)
3. **Docs**
   - Add `docs/pack_manifest_extensions.md`:
     - extension resolution patterns
     - pinning guidance (digest required in strict mode)
     - examples for inline vs remote
4. **Tests**
   - Add fixtures under `tests/fixtures/`:
     - `manifest_no_ext.json`
     - `manifest_with_unknown_ext.json`
     - `manifest_with_provider_ext.json` (inline)
   - Add tests:
     - parse old manifest (no extensions)
     - parse manifest with unknown extension key
     - round-trip equality for known extension

## File-by-file checklist
- [ ] `src/pack_manifest.rs` (add field)
- [ ] `src/<new_or_existing_module>.rs` (add `ExtensionRef`)
- [ ] `docs/pack_manifest_extensions.md`
- [ ] `tests/fixtures/*.json`
- [ ] `tests/pack_manifest_extensions.rs` (new test module)

## Acceptance criteria
- Old manifests parse unchanged.
- Unknown extensions do not fail parsing.
- Round-trip serialization stable/deterministic.
- CI passes.

## Notes for Codex
- Keep changes minimal and strictly additive.
- Avoid introducing domain types or referencing provider categories.
